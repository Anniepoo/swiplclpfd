<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Anne Ogborn">
<title>CLP(FD) Constraint Logic Programming over Finite Domains</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>CLP(FD) Constraint Logic Programming over Finite Domains</h1>
<div class="details">
<span id="author" class="author">Anne Ogborn</span><br>
<span id="email" class="email"><a href="mailto:annie66us@yahoo.com">annie66us@yahoo.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_about_this_tutorial">1. About This Tutorial</a>
<ul class="sectlevel2">
<li><a href="#_who_should_do_this_tutorial">1.1. Who Should Do This Tutorial</a></li>
<li><a href="#_what_is_clp_fd_good_for">1.2. What Is clp(fd) good for?</a></li>
<li><a href="#_prerequisites">1.3. Prerequisites</a></li>
<li><a href="#_what_you_can_expect_from_this_tutorial">1.4. What You Can Expect From This Tutorial</a></li>
<li><a href="#_time_to_complete">1.5. Time to Complete</a></li>
</ul>
</li>
<li><a href="#_the_clp_fd_library">2. The CLP(FD) Library</a></li>
<li><a href="#_variables">3. Variables</a>
<ul class="sectlevel2">
<li><a href="#_replacement_variables">3.1. Replacement Variables</a></li>
<li><a href="#_logic_variables">3.2. Logic Variables</a></li>
<li><a href="#_constrained_variables">3.3. Constrained Variables</a></li>
<li><a href="#_implementation">3.4. Implementation</a></li>
<li><a href="#_domains">3.5. Domains</a></li>
</ul>
</li>
<li><a href="#_an_example">4. An Example</a></li>
<li><a href="#_labeling">5. Labeling</a></li>
<li><a href="#_simple_constraints">6. Simple Constraints</a></li>
<li><a href="#_constraining_to_a_domain">7. Constraining to a Domain</a>
<ul class="sectlevel2">
<li><a href="#_in_and_ins">7.1. In and Ins</a></li>
<li><a href="#_the_code_code_operator">7.2. The <code>\/</code> operator</a></li>
<li><a href="#_domain_from_data">7.3. Domain From Data</a></li>
</ul>
</li>
<li><a href="#_arithmetic_operators">8. Arithmetic Operators</a></li>
<li><a href="#_logical_operators">9. Logical Operators</a>
<ul class="sectlevel2">
<li><a href="#__code_code_code_code_negation">9.1. <code><code>#\</code></code> Negation</a></li>
<li><a href="#__code_code_code_code_and">9.2. <code><code>#/\</code></code> And</a></li>
<li><a href="#__code_code_code_code_or">9.3. <code><code>#\/</code></code> Or</a></li>
</ul>
</li>
<li><a href="#_reification">10. Reification</a>
<ul class="sectlevel2">
<li><a href="#__code_code_code_code_equivalency">10.1. <code><code>#&lt;==&gt;</code></code> Equivalency</a></li>
<li><a href="#__code_code_code_code_implication">10.2. <code><code>#==&gt;</code></code> Implication</a></li>
</ul>
</li>
<li><a href="#_commonly_useful_constraints">11. Commonly Useful Constraints</a>
<ul class="sectlevel2">
<li><a href="#_length_list_length">11.1. length(List, Length)</a></li>
<li><a href="#_all_different_list">11.2. all_different(List)</a></li>
<li><a href="#_tuples_in_listofvariabletuples_listofacceptedtuples">11.3. tuples_in(+ListOfVariableTuples, +ListOfAcceptedTuples)</a></li>
<li><a href="#_sudoku">11.4. Sudoku</a></li>
<li><a href="#_zcompare_order_a_b">11.5. zcompare(?Order, ?A, ?B)</a></li>
</ul>
</li>
<li><a href="#_resources">12. Resources</a></li>
<li><a href="#_sequences">13. Sequences</a>
<ul class="sectlevel2">
<li><a href="#_chain_list_relation">13.1. chain(+List, +Relation)</a></li>
<li><a href="#_lex_chain_lists">13.2. lex_chain(+Lists)</a></li>
<li><a href="#_element_index_list_element">13.3. element(?Index, +List, ?Element)</a></li>
<li><a href="#_circuit_list">13.4. circuit(+List)</a></li>
<li><a href="#_automaton">13.5. automaton</a></li>
</ul>
</li>
<li><a href="#_scheduling">14. Scheduling</a>
<ul class="sectlevel2">
<li><a href="#_global_cardinality_3">14.1. global_cardinality/3</a></li>
<li><a href="#__code_cumulative_2_code_and_code_cumulative_1_code">14.2. <code>cumulative/2</code> and <code>cumulative/1</code></a></li>
</ul>
</li>
<li><a href="#_optimization">15. Optimization</a></li>
<li><a href="#_making_labeling_fast">16. Making Labeling Fast</a>
<ul class="sectlevel2">
<li><a href="#_how_to_label_efficiently">16.1. How To Label Efficiently</a></li>
<li><a href="#_settings">16.2. settings</a></li>
</ul>
</li>
<li><a href="#_debugging_and_testing">17. Debugging and Testing</a></li>
<li><a href="#_applying_constraints_in_stages">18. Applying Constraints in Stages</a></li>
<li><a href="#_making_your_own_constraints">19. Making Your Own Constraints</a></li>
<li><a href="#_conclusion">20. Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="/swipltuts/index.html">Up to All Tutorials</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about_this_tutorial">1. About This Tutorial</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_who_should_do_this_tutorial">1.1. Who Should Do This Tutorial</h3>
<div class="paragraph">
<p>This tutorial is for reasonably experienced SWI-Prolog programmers who want to use clp(fd).</p>
</div>
<div class="paragraph">
<p>Additionally, this tutorial will be useful for Prolog programmers using other versions of Prolog who want to use clp(fd).</p>
</div>
<div class="paragraph">
<p>The emphasis of this tutorial is <strong>not</strong> on the theory. The author
is not a mathematician and the tutorial will probably not be of
much use to competent mathematicians who can approach the material
via the academic literature.</p>
</div>
<div class="paragraph">
<p>This tutorial should give you a grasp of the fundamentals of constraint systems on finite domains.</p>
</div>
<div class="paragraph">
<p>A certain minimal amount of <em>practical wisdom</em> is covered.</p>
</div>
<div class="paragraph">
<p>But mostly this
tutorial is a translation of the SWI-Prolog documentation of the clp(fd) predicates
from the rather terse, math laden documentation
to a more approachable level of English.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_clp_fd_good_for">1.2. What Is clp(fd) good for?</h3>
<div class="paragraph">
<p>clp(fd) is a library included in the standard SWI-Prolog distribution. It solves problems that involve sets of variables, where relationships among the variables need satisfied.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Robert_Wadlow.jpg" alt="Robert Wadlow" width="at 108 inches the tallest person known">
</div>
</div>
<div class="paragraph">
<p>clp(fd) is also useful for replacing many of the guard functions provided by getters and setters in OO languages. For example, if we don&#8217;t know a person&#8217;s actual height yet, we can still assert that it&#8217;s more than 21 and less than 108 inches (shortest/tallest people known).
When we eventually do find a solution, unreasonable values will be rejected.</p>
</div>
<div class="paragraph">
<p>clp(fd) is useful for optimizing search problems by reducing search spaces. Constraints can trim away entire subtrees of the search space.</p>
</div>
<div class="paragraph">
<p>clp(fd) is useful for solving a wide variety of <em>find values for these variables</em> problems. Here are some broad categories of problems that clp(fd) can address:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scheduling problems, like, <em>when should we do what work in this factory to make these products?</em></p>
</li>
<li>
<p>Optimization problems, like <em>which mix of products should we make in this factory to maximize profits?</em></p>
</li>
<li>
<p>Satisficing problems,  like finding an arrangement of rooms in a hospital that meets criteria like having the operating theater near the recovery rooms, or finding a set of vacation plans the whole family can agree on.</p>
</li>
<li>
<p>Sequence problems, like finding a travel itinerary that gets us to our destination.</p>
</li>
<li>
<p>Labeling problems, like Sudoku or Cryptarithm puzzles</p>
</li>
<li>
<p>Problems of belief and intention, like detective puzzles and NPC&#8217;s in games</p>
</li>
<li>
<p>Allocation problems, like finding an assignment of flight crews to aircraft that meets union requirements for maximum time away from home</p>
</li>
<li>
<p>finding acceptable solutions to linked sets of variables, for example, working out who&#8217;se going to the party among a group of jealous teenage girls when A will only go if B goes, but B won&#8217;t go if C goes, and so on</p>
</li>
<li>
<p>Creating lists of acceptable alternatives for multiple interacting variables. For example, a caterer might want to see different offerings for a banquet menu that meet some criteria of cost, scheduling of cooks and waiters, ovens, and so on, then decide for themeselves which to select.</p>
</li>
<li>
<p>Geometric constraints for graphics, eg. a CAD system, where two lines must be perpendicular, another two parallel, others 30 inches apart, and so on.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Uses of clp(fd) Exercise</div>
<div class="paragraph">
<p>Make up another example for each of the categories above. Try to expand the domain of the problem as much as you can. For example, given a set of train cars, putting them in an order that makes sense and obeys some rules (e.g. no tank cars next to the engine, the caboose has to be on the back) is a sequence problem.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites">1.3. Prerequisites</h3>
<div class="paragraph">
<p>Competence in the basics of SWI-Prolog.</p>
</div>
<div class="paragraph">
<p>A level of mathematical sophistication comparable to that of an
upper level standing in a computer science undergrad program.</p>
</div>
<div class="paragraph">
<p>A working SWI-Prolog installation.</p>
</div>
<div class="paragraph">
<p>There is no set of additional code for this tutorial. You can cut and paste many of the examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_you_can_expect_from_this_tutorial">1.4. What You Can Expect From This Tutorial</h3>
<div class="paragraph">
<p>If you read through this tutorial and work all the exercises you
can expect to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>understand the basic concept of constraint programming</p>
</li>
<li>
<p>be able to write programs that find solutions to unknown values</p>
</li>
<li>
<p>be able to formulate real world problems using the clp(fd) library predicates</p>
</li>
<li>
<p>be able to select appropriate solutions to constraint system problems.</p>
</li>
<li>
<p>understand how to use clp(fd) in real world SWI-Prolog programs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_time_to_complete">1.5. Time to Complete</h3>
<div class="paragraph">
<p>6-8 hours, though it varies with one&#8217;s mathematical experience.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_clp_fd_library">2. The CLP(FD) Library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The clp(fd) library for SWI-Prolog was written by Markus Triska for his PhD thesis. clp(fd) stands for <em>Constraint Logic Programming over Finite Domains</em>.</p>
</div>
<div class="paragraph">
<p>clp(fd) is one of several constraint solvers available in SWI-Prolog. There are others: clp(b), clp(qr). clp(b) handles booleans. clp(qr) handles rationals and reals. CHR is a tool for making your own constraint systems (among other things).</p>
</div>
<div class="paragraph">
<p>The clp(fd) library can be activated by simply</p>
</div>
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).</pre>
</div>
</div>
<div class="paragraph">
<p>This installs a compile-time hook that optimizes some clp(fd) constraints, and loads a run-time library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_variables">3. Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use the term <em>variable</em> rather loosely in computer science.</p>
</div>
<div class="sect2">
<h3 id="_replacement_variables">3.1. Replacement Variables</h3>
<div class="paragraph">
<p>In imperative languages like Java variables are mutable.
Their values change over time.</p>
</div>
<div class="paragraph">
<p>In C, a variable like x</p>
</div>
<div class="listingblock">
<div class="content">
<pre>int x;

... what about here? ...

x = 5;</pre>
</div>
</div>
<div class="paragraph">
<p>always has a value. Before we assign 5 to it, the value is whatever happened to be in that memory location (a source of delight for security programmers everywhere).</p>
</div>
</div>
<div class="sect2">
<h3 id="_logic_variables">3.2. Logic Variables</h3>
<div class="paragraph">
<p>Variables in a logic language are different. They are much more like variables or <em>unknowns</em> in high school algebra.</p>
</div>
<div class="paragraph">
<p>In Prolog a variable
can be bound or unbound. An unbound variable will unify with any
value. A bound variable unifies only with one template.</p>
</div>
<div class="paragraph">
<p>In effect, we either know, or don&#8217;t know, the value of the variable.</p>
</div>
<div class="paragraph">
<p>When we try to unify, we are, effectively, asking, "is what we know
about the answer on the left compatible with what we know about the answer on the right?"
Bob claims to be good friends with the Mayor of Maintown. If Bob&#8217;s the editor of the Maintown Daily, that&#8217;s entirely believable. If Bob also claims to have never set foot in Maintown, it&#8217;s inconsistent.</p>
</div>
<div class="paragraph">
<p>In Prolog we have only two possibilities, for an atomic result. Know absolutely nothing, or know exactly. Obviously we might have unbound variables within a list or term, but for each variable there are only these two states.</p>
</div>
</div>
<div class="sect2">
<h3 id="_constrained_variables">3.3. Constrained Variables</h3>
<div class="paragraph">
<p>But in the real world we can say more about a variable.</p>
</div>
<div class="paragraph">
<p>We might not know the exact value, but we know it is one of a set of possible values. We call this it&#8217;s <em>domain</em>.</p>
</div>
<div class="paragraph">
<p>We might know it&#8217;s value is, say, greater than the value of some other variable, whose value we also don&#8217;t know. We say the variable is <strong>constrained</strong>.</p>
</div>
<div class="paragraph">
<p>As we begin to accumulate constraints, we start to be able to
reason about the constraints.
Suppose we have two variables, X and Y, which are integers.</p>
</div>
<div class="paragraph">
<p>Now I tell you that X is in the range 0 to 10.</p>
</div>
<div class="paragraph">
<p>Further I tell you that Y is in range 4 to 8.</p>
</div>
<div class="paragraph">
<p>And finally that X is more than Y.</p>
</div>
<div class="paragraph">
<p>You can infer that X is within the narrower range 5 to 10, since the lowest value Y can have is 4, and X must be one more than Y.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how it looks in clp(fd). Don&#8217;t worry if you don&#8217;t understand all of this yet</p>
</div>
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).         <img src="./images/icons/callouts/1.png" alt="1">

test(X, Y) :-
    X in 0..10,     <img src="./images/icons/callouts/2.png" alt="2">
	Y in 4..8,      <img src="./images/icons/callouts/3.png" alt="3">
	X #&gt; Y.         <img src="./images/icons/callouts/4.png" alt="4">


14 ?- test(X, Y).
X in 5..10,           <img src="./images/icons/callouts/5.png" alt="5">
Y#=&lt;X+ -1,     <img src="./images/icons/callouts/6.png" alt="6">
Y in 4..8.</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>include the clp(fd) library</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>constrain X to be in 0 through 10 using the <em>in</em> operator</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>constrain Y to be in 4 through 8 using the <em>in</em> operator</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>constrain X to be greater than Y using the <em>#&gt;</em> operator</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>X is now constrained to 5 through 10</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>Y is now constrained to be =&lt; X - 1 (same as X &gt; Y), and in the range 4 through 8.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we have constrained a variable to a single value, something rather magical happens - we now know the value of the variable, so we can bind the variable. And in clp(fd) this is indeed what happens! Suppose I constrain X to the range 0 to 5, and Y to 4 to 8, and X &gt; Y, then suddenly X is now in bound to 5. ground(X) succeeds, and X is a perfectly ordinary bound variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).

test2(X, Y) :-
     X in 0..5,
	 Y in 4..8,
	 X #&gt; Y.

16 ?- test2(X,Y).
X = 5,     <img src="./images/icons/callouts/1.png" alt="1">
Y = 4.     <img src="./images/icons/callouts/2.png" alt="2"></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>X is bound just like normal Prolog</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Notice that Y is bound too. Further, it&#8217;s lost it&#8217;s original constraints</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">punch and run Exercise</div>
<div class="paragraph">
<p>Type in and try the two examples above. Step into them with the graphic debugger to see the constraints listed.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">backtracking Exercise</div>
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).

foo(X) :- X in 1..3 .
foo(X) :- X in 5..7 .
foo(X) :- X in 8..12 .</pre>
</div>
</div>
<div class="paragraph">
<p>What will happen if you query foo(X) and get all the solutions by backtracking?
Predict what will happen, and then try it. Was your prediction correct?</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implementation">3.4. Implementation</h3>
<div class="paragraph">
<p>SWI-Prolog has the ability to add <strong>attributes</strong> to variables. This is additional meta-data attached to the variable. If you&#8217;re interested, you can read more about attributed variables at <a href="http://swi-prolog.org/pldoc/man?section=attvar">The SWI-Prolog website</a>.</p>
</div>
<div class="paragraph">
<p>clp(fd) uses this attribute data to decorate the variables with constraints. Then clp(fd) implements constraint programming as an expansion of the normal Prolog unification.</p>
</div>
<div class="paragraph">
<p>More on this at the end of the tutorial.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">attributes Exercise</div>
<div class="paragraph">
<p>Extra credit -</p>
</div>
<div class="paragraph">
<p>Think up another use for attributes on variables besides constraints</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_domains">3.5. Domains</h3>
<div class="paragraph">
<p>The (fd) in clp(fd) stands for <em>finite domain</em>. This domain could have millions of values, but it must be a finite list.</p>
</div>
<div class="paragraph">
<p>We&#8217;re only concerned with variables with a finite domain, the <strong>finite domain</strong> of the name. For our purposes that means we want to reason about domains that are sets of integers.</p>
</div>
<div class="paragraph">
<p><code>clp(fd)</code> works with a domain like <code>[air, land, sea]</code>, but can&#8217;t optimize well. Better to map air=0, land=1, sea=2 and then say the domain is <code>0..2</code> .
Any finite list of possibilites can be mapped into a finite subset of the integers.</p>
</div>
<div class="paragraph">
<p>At first this can seem awkward, but it&#8217;s really no different than using array indices. A bigger issue can be debugging - lists of integers can be pretty meaningless. Writing some debug code to extract the data and print it can help.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_an_example">4. An Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I&#8217;m always annoyed by discussions that blather on, ungrounded in reality. So here&#8217;s a classic constraint program, with brief descriptions of the parts. You may not understand all the parts yet.</p>
</div>
<div class="paragraph">
<p>The SEND + MORE = MONEY cryptoarithmetic puzzle is a classic
"hello world" for constraint programming. The puzzle is
to assign the digits 0 thru 9 to letters such that they
spell out SEND MORE MONEY and when read as base 10 numbers
create a true mathematical formula. Leading zeros are not
permitted on numbers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).         <img src="./images/icons/callouts/1.png" alt="1">

puzzle([S,E,N,D] + [M,O,R,E] = [M,O,N,E,Y]) :-   <img src="./images/icons/callouts/2.png" alt="2">
        Vars = [S,E,N,D,M,O,R,Y],     <img src="./images/icons/callouts/3.png" alt="3">
        Vars ins 0..9,      <img src="./images/icons/callouts/4.png" alt="4">
        all_different(Vars),        <img src="./images/icons/callouts/5.png" alt="5">
                  S*1000 + E*100 + N*10 + D +     <img src="./images/icons/callouts/6.png" alt="6">
                  M*1000 + O*100 + R*10 + E #=
        M*10000 + O*1000 + N*100 + E*10 + Y,
        M #\= 0, S #\= 0,    <img src="./images/icons/callouts/7.png" alt="7">
		label(Vars).  <img src="./images/icons/callouts/8.png" alt="8">

9 ?- puzzle(X).
X = ([9, 5, 6, 7]+[1, 0, 8, 5]=[1, 0, 6, 5, 2]) ;  <img src="./images/icons/callouts/9.png" alt="9">
false.</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>include the clp(fd) library</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>note the clp(fd) is not an embedded DSL like pce or quasiquotes. clp(fd) <em>rides along</em> with Prolog, adding semantics.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>for convenience make a list of all the variables we&#8217;ll constrain</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>restrict each variable in Vars to the range 0..9 inclusive</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>add the constraint that they must all be different</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>add the arithmetic constraint that defines the puzzle</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/7.png" alt="7"></td>
<td>M and S start words, and hence cannot be zero</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/8.png" alt="8"></td>
<td>attempt to ground as many variables as possible.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/9.png" alt="9"></td>
<td>notice that there&#8217;s no funny attribution outside, it just returns the solution</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">FortyTenTen Exercise</div>
<div class="paragraph">
<p>1) Solve the cryptarithm
FORTY + TEN + TEN = SIXTY
by modifying the program</p>
</div>
<div class="paragraph">
<p>2) are there more solutions to SEND+MORE=MONEY if you allow leading zeros? Modify the program to find out.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_labeling">5. Labeling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Attaching constraints is nice, but ultimately of little use until we can get back to simply grounding the variables. A solution with all the variables ground is called a <em>ground solution</em>.</p>
</div>
<div class="paragraph">
<p>There are a few minor mechanisms for doing so.</p>
</div>
<div class="paragraph">
<p>If you reduce the domain to a single value, the variable will be ground.</p>
</div>
<div class="paragraph">
<p>You can simply ground the variable normally. The usual <code>X = 3</code> constrains the variable to a single value.</p>
</div>
<div class="paragraph">
<p>And the predicate <code>indomain/1</code> successively binds a single variable to it&#8217;s possible values on backtracking.</p>
</div>
<div class="paragraph">
<p>But mostly we call <code>label/1</code> or <code>labeling/2</code> to find a single ground solution. <code>label/1</code> and <code>labeling/2</code> are nondeterministic, binding a different set of values on each backtracking.</p>
</div>
<div class="paragraph">
<p>Of course our constraint system may not be powerful enough to express every constraint. If so, we must fall back on the generate and test search strategy familiar to all Prolog programmers. With constraint systems, generate and test becomes</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>constrain</p>
</li>
<li>
<p>generate (by labeling)</p>
</li>
<li>
<p>test</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>and indeed most clp(fd) programs follow a general pattern of constrain followed by label.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
It&#8217;s a good practice to set up the model and do the labeling and any remaining searching in separate predicates. This makes it easier to inspect the model before labeling is applied.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>labeling/2</code> has a wealth of options that affect the variable selection strategy. Since most of the time taken by a clp(fd) program is usually in the labeling, we&#8217;ll cover these in detail later. For now we&#8217;ll use <code>label/1</code>, which has reasonable defaults.</p>
</div>
<div class="paragraph">
<p>The options in <code>labeling/2</code> are also used with optimization problems of the <em>make the most profit</em> type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_constraints">6. Simple Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>clp(fd) provides a basic set of primitive constraints.</p>
</div>
<div class="paragraph">
<p>Remember that clp(fd) works with integers.</p>
</div>
<div class="listingblock">
<div class="title">simple operators</div>
<div class="content">
<pre>X #&gt;= Y
X #=&lt; Y
X #= Y
X #\= Y
X #&gt; Y
X #&lt; Y</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
You can use <code>#=</code> as a declarative version of <code>is</code>, in what is otherwise not a clp(fd) program. <code>X is 3+Y</code> requires Y to be ground, while <code>X #= 3+Y</code> works if X is ground and Y is not.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
<code>X #&lt; Y</code> is useful to get rid of uninteresting symmetries. For example, if players 1 and 3 are matched in a tournament then there&#8217;s no point considering the match 3 and 1. Consider this example taken from the SWI-Prolog documentation that finds all the ways to pair up 4 people:
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 1. Removing Symmetry</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>?- Vs = [A,B,C,D], Vs ins 1..4,
        all_different(Vs),
        A #&lt; B, C #&lt; D, A #&lt; C,
   findall(pair(A,B)-pair(C,D), label(Vs), Ms).
Ms = [ pair(1, 2)-pair(3, 4),
       pair(1, 3)-pair(2, 4),
       pair(1, 4)-pair(2, 3)].</pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Strictly Increasing Exercise</div>
<div class="paragraph">
<p>Write a predicate <code>increase/1</code> that takes a list and constrains it to be strictly increasing.</p>
</div>
<div class="paragraph">
<p>First record what result you expect from each query below. Then test that your predicate does what you expect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>?- increase([1, X, 3]).

?- increase([1, X, 4]).

?- increase([1,X, Y, 4]).

?- increase([1,2]).

?- increase([1,X]).</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_constraining_to_a_domain">7. Constraining to a Domain</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clp(fd) is concerned with the domains of variables.</p>
</div>
<div class="paragraph">
<p>The <em>domain</em> of a variable is simply the set of values it can take on.</p>
</div>
<div class="paragraph">
<p>In clp(fd) every variable must be restricted to a "finite domain" in order to reason about it.
You <em>do need</em> to give variables a domain before you try to label them! If not, you&#8217;ll get a baffling <code>ERROR: Arguments are not sufficiently instantiated</code> exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>X in 5..10,   <img src="./images/icons/callouts/1.png" alt="1">
Y in 1..10,   <img src="./images/icons/callouts/2.png" alt="2">
Y #&gt; X        <img src="./images/icons/callouts/3.png" alt="3"></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Set a domain for X - in this case 5 through 10</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Set a domain for Y - 1 through 10</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Now constraint Y to be more than X.  So we can reason about Y&#8217;s domain. Y must be one of the values 6,7,8,9, or 10.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Oddly, for all the talk of <em>finite</em> domains, it&#8217;s allowed to constrain a variable to a domain like <code>4..sup</code> - 4 through infinity. <code>inf</code> is negative infinity.</p>
</div>
<div class="sect2">
<h3 id="_in_and_ins">7.1. In and Ins</h3>
<div class="paragraph">
<p>You can restrict the domains of variables with the <code>in</code> and <code>ins</code> operators.</p>
</div>
<div class="paragraph">
<p>Both <code>in</code> and <code>ins</code> take a domain on the right side.
A domain is a simple range or a union of simple ranges with the
\/ operator</p>
</div>
<div class="paragraph">
<p>A simple domain can be a single integer or a pair of bounds connected with double dots. The bounds can be integers, or <code>inf</code> for the least member or <code>sup</code> for the greatest member. Any of these can be a ground variable, like <code>N=3, X in 1..N</code> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_code_code_operator">7.2. The <code>\/</code> operator</h3>
<div class="paragraph">
<p>Domains can be unioned together with the <code>\/</code> operator</p>
</div>
<div class="listingblock">
<div class="title">Unions</div>
<div class="content">
<pre>1..3 \/ 5..7</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a more complex domain.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Complex Domain</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>V in inf.. -2 \/ 0 \/ 2..16 \/ 18..sup</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>in</code> constrains a single variable.</p>
</div>
<div class="paragraph">
<p><code>ins</code> constrains a list of variables to the same values, the equivilent of maplist over the list with in.</p>
</div>
</div>
<div class="sect2">
<h3 id="_domain_from_data">7.3. Domain From Data</h3>
<div class="paragraph">
<p>What if your domain data comes from input data? Suppose we get a data structure from somewhere and need to constrain to it in some way.</p>
</div>
<div class="paragraph">
<p>Assemble your domain as a term <code>MyDomain</code> and use <code>X in MyDomain</code>. Here&#8217;s an example</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. A Domain From Data</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>% Bases is a list of ints. Constrain Var to be within B..B+2 for B
% a member of Bases

two_domains(Bases, Var) :-
	make_two_domains(Bases, Term),
	Var in Term.

make_two_domains([H], H..HT) :-
	HT is H + 2.
make_two_domains([H | T], '\\/'(H .. HT, TDomain)) :-
	HT is H + 2,
	make_two_domains(T, TDomain).

25 ?- two_domains([1, 8, 16], V).
 V in 1..3\/8..10\/16..18 ;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arithmetic_operators">8. Arithmetic Operators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can do a lot of constraint work with the arithmetic constraints.</p>
</div>
<div class="paragraph">
<p>Constraints can take infix arithmetic expressions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>X + 2 #= Y * 3</pre>
</div>
</div>
<div class="paragraph">
<p>The available operators are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unary -,</p>
</li>
<li>
<p>+,</p>
</li>
<li>
<p>-,</p>
</li>
<li>
<p>*,</p>
</li>
<li>
<p>/ (truncated integer division),</p>
</li>
<li>
<p>^ (exponentiation),</p>
</li>
<li>
<p>min,</p>
</li>
<li>
<p>max,</p>
</li>
<li>
<p>mod,</p>
</li>
<li>
<p>rem,</p>
</li>
<li>
<p>abs</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logical_operators">9. Logical Operators</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__code_code_code_code_negation">9.1. <code><code>#\</code></code> Negation</h3>
<div class="paragraph">
<p>Unary. Inverts the contained constraint.</p>
</div>
</div>
<div class="sect2">
<h3 id="__code_code_code_code_and">9.2. <code><code>#/\</code></code> And</h3>
<div class="paragraph">
<p>Constrains both sides to hold.</p>
</div>
</div>
<div class="sect2">
<h3 id="__code_code_code_code_or">9.3. <code><code>#\/</code></code> Or</h3>
<div class="paragraph">
<p>Constrains at least one side to hold.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reification">10. Reification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reification is the process of using constraints to control other constraints. clp(fd) includes two operators for reification.</p>
</div>
<div class="sect2">
<h3 id="__code_code_code_code_equivalency">10.1. <code><code>#&lt;==&gt;</code></code> Equivalency</h3>
<div class="paragraph">
<p>Each side may be a boolean variable (a 0 or 1) or a constraint. The constraints are modified so they both hold, or their negations both hold.</p>
</div>
</div>
<div class="sect2">
<h3 id="__code_code_code_code_implication">10.2. <code><code>#==&gt;</code></code> Implication</h3>
<div class="paragraph">
<p>If the left side holds, then the right side must hold.
If the left side does not hold, then the right side is ignored.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Some Reified Constraints</div>
<div class="content">
<div class="paragraph">
<p>In a chemical plant there is a reaction vessel. The
temperature in the vessel is constrained to be less
than a certain value, and to be more than another value,
except when in <em>startup</em> mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chem_tank(Temp, Startup) :-
	Temp #&lt; 800,
	#\ Startup #==&gt; Temp #&gt; 300.</pre>
</div>
</div>
<div class="paragraph">
<p>We can define startup mode as lasting for 10 minutes after
some StartTime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chem_demo(Temp, TimeNow, StartTime) :-
	chem_tank(Temp, TimeNow - StartTime #&lt; 10).</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>StartTime</code> is passed in <strong>as a constraint</strong> . You can build a predicate
that applies constraints and apply conditions under which they apply.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Employment exercise</div>
<div class="paragraph">
<p>Write a small system that matches people with jobs. The jobs have requirements for education level, weight they can lift, age, distance from home. Be able to record special constraints in the individual&#8217;s
record - eg. Bob&#8217;s on parole and can&#8217;t work more than 20 miles from home. Sally wants a helper, but has had problems with workers hanging around when not working, she wants someone who lives more than 10 miles away.</p>
</div>
<div class="paragraph">
<p>People have funny situations, so try to make it general.</p>
</div>
<div class="paragraph">
<p>For this exercise you can make the (unrealistic) assumption that users know Prolog.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commonly_useful_constraints">11. Commonly Useful Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We now turn to looking at the more <em>convenience</em> predicates provided in the clp(fd) library. Most establish a large number of simple constraints at the same time.</p>
</div>
<div class="paragraph">
<p>As well as introducing the convenience predicates, it&#8217;s also a good way to develop a facility with using constraints.</p>
</div>
<div class="paragraph">
<p>Here are a few constraints that are useful in a wide variety of constraint situations.</p>
</div>
<div class="sect2">
<h3 id="_length_list_length">11.1. length(List, Length)</h3>
<div class="paragraph">
<p>This of course is good ol' length. It&#8217;s useful in the length(-, +) mode
to generate a list of unbound variables.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
<code>length_(Length, List) :- length(List, Length).</code> is sometimes handy to make lists of unbound variables in call + 1 situations.
<code>length(List, 9), maplist(length_(9), List)</code> gives a 2D array of
unbound variables, for example.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">length Exercise</div>
<div class="listingblock">
<div class="content">
<pre>?- length(X, 5).</pre>
</div>
</div>
<div class="paragraph">
<p>Now try</p>
</div>
<div class="listingblock">
<div class="content">
<pre>?- length(X, Y).</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_all_different_list">11.2. all_different(List)</h3>
<div class="paragraph">
<p>This predicate is used frequently. It constrains the members of List to
different values.</p>
</div>
<div class="listingblock">
<div class="title">all_different Example</div>
<div class="content">
<pre> ?- length(List, 4),List ins 1..4, all_different(List), List = [1,_,3,4].
List = [1, 2, 3, 4].</pre>
</div>
</div>
<div class="paragraph">
<p><code>all_different/1</code> is useful in conjunction with the <em>pigeonhole principle</em>, which says that if you have N variables each an element of 1..M , and N &gt; M, then there must be two variables with the same value. In the above example, List must always be a permutation of [1, 2, 3, 4] for this reason.</p>
</div>
<div class="paragraph">
<p>All_distinct works like all_different, but <em>tries harder</em> to detect when all are different.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s try constraining 3 variables to be different values from 1..2 - an impossibility.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>24 ?- X in 1..2, Y in 1..2, Z in 1..2, all_different([X,Y,Z]).
X in 1..2,
all_different([X, Y, Z]),
Y in 1..2,
Z in 1..2.

25 ?- X in 1..2, Y in 1..2, Z in 1..2, all_distinct([X,Y,Z]).
false.

26 ?-</pre>
</div>
</div>
<div class="paragraph">
<p>In the above, <strong>all_different</strong> fails to detect that there are only two possible values for X, Y, and Z, so two of them must be the same.</p>
</div>
<div class="paragraph">
<p><strong>all_distinct</strong> does more work to analyze the domains of it&#8217;s variables, and does detect this condition. The cpu cost of using <code>all_distinct</code> is higher, however - so this needs balanced against performance gains from pruning the search tree earlier.</p>
</div>
<div class="paragraph">
<p>If you are having performance issues it might be worth investigating using one or the other.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tuples_in_listofvariabletuples_listofacceptedtuples">11.3. tuples_in(+ListOfVariableTuples, +ListOfAcceptedTuples)</h3>
<div class="paragraph">
<p>It&#8217;s fairly common to have a list of acceptable combinations of
a few variables. A common situation would be ordering American style
meals, where you order a full meal, whose price includes an entree and
two sides, but you only get one side if you get the pie, etc.
You have to enumerate all the various combinations.</p>
</div>
<div class="paragraph">
<p>The SWI-Prolog documentation contains this cool demo of selecting trains for a journey.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Train Journey</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).

trains([[1,2,0,1], % from station, to station, departs at, arrives at
        [2,3,4,5],
        [2,3,0,1],
        [3,4,5,6],
        [3,4,2,3],
        [3,4,8,9]]).

threepath(A, D, Ps) :-
        Ps = [[A,B,_T0,T1],[B,C,T2,T3],[C,D,T4,_T5]],
        T2 #&gt; T1,
        T4 #&gt; T3,
        trains(Ts),
        tuples_in(Ps, Ts).

?- threepath(1, 4, Ps).
Ps = [[1, 2, 0, 1], [2, 3, 4, 5], [3, 4, 8, 9]].</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Beyond the sheer coolness of this as a path finding method,
notice that we didn&#8217;t have to do any labeling. There&#8217;s only
one solution.</p>
</div>
<div class="paragraph">
<p>If you find yourself with tuples that look like <code>[[1,2], [2,7], [3,8]&#8230;&#8203;]</code> consider using <code>element/3</code> instead.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">tuples_in Exercise</div>
<div class="paragraph">
<p>no 1. Modify the Train Journey program so it finds routes with any number of trains, not just 3.</p>
</div>
<div class="paragraph">
<p>no 2. You are asked to produce a table of employees who are eligible for promotion.
You have this list of lists. Each inner list is a record for a single employee. The fields are employee #, last review score, # of safety violations, time in grade, required time for promotion</p>
</div>
<div class="listingblock">
<div class="content">
<pre>employees([
   [1, 75, 0, 30, 25],
   [2, 83, 0, 45, 25],
   [3, 90, 1, 45, 50],
   [4, 45, 3, 75, 25],
   [5, 89, 0, 52, 50]
   ]).</pre>
</div>
</div>
<div class="paragraph">
<p>To be eligible for promotion an employee must have a last review score of 80 or above, no more than one safety violation, and their time in grade must be more than the required time for promotion.</p>
</div>
<div class="paragraph">
<p>no 3. The last column, time required for promotion, isn&#8217;t normalized. Employees are either team members or team leaders. Team members need 25 weeks in grade, team leaders need 50. The cheif architect has decided to abstract these into a second table so these numbers can be changed easily.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>employees([
   [1, 75, 0, 30, 1],
   [2, 83, 0, 45, 1],
   [3, 90, 1, 45, 2],
   [4, 45, 3, 75, 1],
   [5, 89, 0, 52, 2]
   ]).

time_in_grade([[1,25], [2,50]]).</pre>
</div>
</div>
<div class="paragraph">
<p>Update exercise 2 to use the new data format.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sudoku">11.4. Sudoku</h3>
<div class="paragraph">
<p>OK, this isn&#8217;t really the Sudoku predicate, but <code>transpose(+Matrix, ?Transpose)</code> is useful when
the variables are naturally expressed as a 2D grid.</p>
</div>
<div class="paragraph">
<p>Represent the grid as a list of lists. Each list is
one row.</p>
</div>
<div class="paragraph">
<p>Many constraint predicates work on adjacency of elements in a list.
If you need to operate on rows you can just use maplist.
To operate on columns, transpose the matrix and they&#8217;re now
rows.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
No, you don&#8217;t need to transpose back. The new transposed matrix
shares with the original. Any constraints on it are constraints
on the original.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here, for example, is a program to solve the "quarreling children" problem.
It&#8217;s made considerably simpler by only dealing with rows</p>
</div>
<div class="listingblock">
<div class="title">Quarreling Children</div>
<div class="content">
<pre>/*
	 much shorter quarreling children

	 16 children are to be seated in a
	 4 x 4 array of chairs.

         the children are 8 girls (numbered 1..8) and
	 8 boys (numbered 9..16).

     1,3,5,8 think boys are ucky
	 9,10,11,14 think girls are gross

	 these pairs are enemies

	 [[1,2], [4,6], [4,7], [4, 9],[9,11], [12, 14], [14,16]]

 */

length_(Length, List) :- length(List, Length).

child_row(X) :- X ins 1..16 .

ww(X) :-
	write(X),
	write('/').

print_row(Row) :-
	maplist(ww, Row),
	nl.

children(Class) :-
	length(Class, 4),
	maplist(length_(4), Class),
	maplist(child_row , Class),
	maplist(row_compatible, Class),
	transpose(Class, TransClass),
	maplist(row_compatible, TransClass),
	flatten(Class, FlatClass),
	all_different(FlatClass),
	maplist(label, Class),
	maplist(print_row, Class).

row_compatible([A,B,C,D]) :-
	compatible(A, B),
	compatible(B, C),
	compatible(C, D).

compatible(A, B) :-
	not_enemy(A, B),
	not_enemy(B, A),
	sex_compatible(A, B),
	sex_compatible(B, A).

not_enemy(A, B) :-
	NotA #\= A #\/ NotB #\= B,
	tuples_in([[NotA, NotB]],
		    [[1,2], [4,6], [4,7], [4, 9],[9,11], [12, 14], [14,16]]).

sex_compatible(A, B) :-
	A in 1\/3\/5\/8 #==&gt; B #=&lt; 8,
	A in  9..11\/14 #==&gt; B #&gt; 8.</pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">transpose Exercise</div>
<div class="paragraph">
<p>Write a predicate that will be part of a roguelike game.</p>
</div>
<div class="paragraph">
<p>Your game board is a 2D array (list of lists). Each square contains
one of the following</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0 - floor</p>
</li>
<li>
<p>1 - walls</p>
</li>
<li>
<p>2 - monster</p>
</li>
<li>
<p>3 - the player</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>write a predicate, can_move(+Board, -Moves)
Board will be a board as defined above
SafeMoves will be a list of lists, with a 1 where the player can move
and a 0 where they cannot. Enforce these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The player can move 0,1,2, or 3 spaces, connected horizontally and vertically, not diagonally.</p>
</li>
<li>
<p>The player cannot pass through or end on walls</p>
</li>
<li>
<p>the player cannot pass through or end adjacent to monsters</p>
</li>
<li>
<p>The player cannot move off the board</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sample run (some liberties taken for readability):</p>
</div>
<div class="listingblock">
<div class="title">board Example</div>
<div class="content">
<pre>board([
[1,1,1,1,1,1,1,1],
[1,0,2,0,0,0,0,0],
[0,1,0,0,0,2,0,0],
[0,0,1,0,0,0,0,3],
[0,0,0,1,0,0,2,0],
[0,0,0,0,1,0,0,0],
[0,0,0,0,0,1,0,0],
[0,0,0,0,0,0,1,0],
[0,0,0,0,0,0,0,1]
]).

?- board(B), can_move(B, M), writeq(M).
M = [
[0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,1,1],
[0,0,0,0,0,0,0,1],
[0,0,0,0,0,0,0,1],
[0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0]
]</pre>
</div>
</div>
<div class="paragraph">
<p>Hint: write a predicate to print out M in a more readable format
Extra credit: use the terminal coloring library to make that fancy</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zcompare_order_a_b">11.5. zcompare(?Order, ?A, ?B)</h3>
<div class="paragraph">
<p>zcompare is useful when you need to know the relationship between the domains of two unlabeled variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>10 ?- X in 0..10, Y in 11..20,zcompare(C, X, Y).
C = (&lt;),
X in 0..10,
Y in 11..20.

11 ?- X in 0..11, Y in 11..20,zcompare(C, X, Y).
X in 0..11,
zcompare(C, X, Y),
freeze(C, clpfd:zcompare_(C, X, Y)),
Y in 11..20.</pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;ll admit, that second one puzzled me a bit. C, it turns out, is still unbound, since we can&#8217;t really tell the relationship between X and Y when their domains overlap. But if C becomes bound later, then it will go back and constrain X and Y!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>15 ?- X in 0..11, Y in 11..20,zcompare(C, X, Y),C = &lt;, writeln(C).
&lt;
C = (&lt;),
X in 0..11,
X#=&lt;Y+ -1,
zcompare(&lt;, X, Y),
Y in 11..20.</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
Annie is here, looking like this =8cO trying to imagine debugging code that uses lots of zcompares
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">zcompare Exercise</div>
<div class="paragraph">
<p>create a constraint <code>same_side_of_line/4</code> , whose arguments are dicts of the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre>point{x:12.34, y:56.78}</pre>
</div>
</div>
<div class="paragraph">
<p>The first two arguments are points on a line, the next two are two test points. The predicate succeds if both test points are on the same side of the line, or both are on the line, the constraint holds.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">12. Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>clp(fd) is great with resource constrained problems.</p>
</div>
<div class="paragraph">
<p>Scheduling problems are often a repeated series of resource constraint problems.</p>
</div>
<div class="paragraph">
<p>Most such problems can be worked with the primitive constraints, but a couple built in clp(fd) constraints are useful.
<code>sum/3</code> and <code>scalar_product/4</code> are fairly straightforward.</p>
</div>
<div class="paragraph">
<p>The use of <code>scalar_product/4</code> might not be obvious. It&#8217;s useful for defining relationships where different things have different <em>costs</em> (in time, money, or something else).</p>
</div>
<div class="listingblock">
<div class="title">Penny Candy</div>
<div class="content">
<pre>%
%  penny candy example
%  Timmy has 25 cents
%  gumballs cost a penny
%  snickers cost 10 cents
%  toffees are 2 cents
%  licorice costs 5 cents
%
%  what are Timmys alternatives?
%  assume Timmy spends the entire 25 cents
scalar_test(Candy) :-
	Candy = [_Gumball, _Snickers, _Toffee, _Licorice],
	Candy ins 0..sup,
	scalar_product([1, 10, 2, 5], Candy, #=, 25),
	label(Candy).

6 ?- scalar_test([Gumball, Snickers, Toffee, Licorice]).
Gumball = Snickers, Snickers = Toffee, Toffee = 0,
Licorice = 5 ;
Gumball = Snickers, Snickers = 0,
Toffee = 5,
Licorice = 3 ;
Gumball = Snickers, Snickers = 0,
Toffee = 10,
Licorice = 1 ;
Gumball = Toffee, Toffee = 0,
Snickers = 1,
Licorice = 3 ;
Gumball = 0,
Snickers = Licorice, Licorice = 1,
Toffee = 5 ;
...</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
Try the penny candy example without the <code>Candy ins 0..sup</code> line.
What will happen?
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sequences">13. Sequences</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We often need things to be in a specific sequence.</p>
</div>
<div class="paragraph">
<p>These constraints help establish sequences.</p>
</div>
<div class="sect2">
<h3 id="_chain_list_relation">13.1. chain(+List, +Relation)</h3>
<div class="paragraph">
<p>Chain establishes the Relation constraint between each
pair of adjacent elements in List.</p>
</div>
<div class="listingblock">
<div class="title">Chain Example</div>
<div class="content">
<pre>chain_example([A,B,C,D]) :-
	chain([A,B,C,D], #&gt;=).

?- chain_example(X).
X = [_G4676, _G4679, _G4682, _G4685],
_G4676#&gt;=_G4679,
_G4679#&gt;=_G4682,
_G4682#&gt;=_G4685.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lex_chain_lists">13.2. lex_chain(+Lists)</h3>
<div class="paragraph">
<p><code>lex_chain/1</code> is more interesting.  It takes a list of lists.</p>
</div>
<div class="paragraph">
<p>It constrains the inner lists to be <em>lexicographically non-decreasing</em>.
This means they should be sorted by columns starting on the left. This is the normal way we sort text</p>
</div>
<div class="listingblock">
<div class="content">
<pre>andy
babble &lt;-- below andy because a is less than b
beef   &lt;-- below babble because a is less than e
been   &lt;-- below beef because f is less than n</pre>
</div>
</div>
<div class="paragraph">
<p>Besides the obvious use of sorting text, lex_chain has other sorting uses.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Hospital Patients</div>
<div class="paragraph">
<p>Patients in a hospital have a coded set of information as a term.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>patient(ID, Name, YearAdmitted, MonthAdmitted, DayAdmitted, HourAdmitted, MinuteAdmitted, Status, Payment)</pre>
</div>
</div>
<div class="paragraph">
<p>Status is either 0 (normal) or 1 (emergency).</p>
</div>
<div class="paragraph">
<p>Payment is either 0 (private), 1 (insurance), or 2 (medicaid).</p>
</div>
<div class="paragraph">
<p>here&#8217;s some patients</p>
</div>
<div class="listingblock">
<div class="content">
<pre>patient(1, 'Bob Jones', 2014, 10, 1, 4, 55, 0, 2).
patient(2, 'Sally Smith', 2014, 9, 29, 5, 15, 1, 0).
patient(3, 'Ted Overton', 2014, 9, 30, 14, 15, 0, 0).
patient(4, 'Arnold Abouja', 2014, 10, 1, 5, 0, 0, 0).
patient(5, 'Seth Humbolt', 2014, 10, 1, 5, 10, 0, 0).</pre>
</div>
</div>
<div class="paragraph">
<p>constrain the patients to be seen acording to these rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>See all emergency cases first, before any normal cases.</p>
</li>
<li>
<p>for patients with same status (emergency/normal), see patients in the order they arrived, except</p>
</li>
<li>
<p>If a private or insurance patient arrived up to an hour after a medicaid patient, see them first.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Hint: use lex_chain</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_element_index_list_element">13.3. element(?Index, +List, ?Element)</h3>
<div class="paragraph">
<p>Element is the constraint equivilent of <code>nth1/3</code> .</p>
</div>
<div class="paragraph">
<p>It constrains an element of a list by it&#8217;s location in the list. Element must be the Indexth member of List, counting from 1.</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Suzy Flirting Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>%
% Suzy wants to flirt with Nathan
% But not when her old boyfriend John is around
%
% Suzy, Nathan, and John all must take classes 1..6
%
% How can Suzy arrange her schedule so she can flirt
% in at least 3 classes?

flirt_constraint(Suzy, Nathan, John, FlirtPeriods) :-
	length(Suzy, 6),
	length(Nathan, 6),
	length(John, 6),
	Suzy ins 1..6,
	Nathan ins 1..6,
	John ins 1..6,
	all_different(Suzy),
	all_different(Nathan),
	all_different(John),
	FlirtPeriods = [A,B,C],
	FlirtPeriods ins 1..6,
	A #&lt; B,    % remove unwanted symmetry
	B #&lt; C,
	flirty_period(A, Suzy, Nathan, John),
	flirty_period(B, Suzy, Nathan, John),
	flirty_period(C, Suzy, Nathan, John),
	label(Suzy),
	label(FlirtPeriods).

flirty_period(Period, Suzy, Nathan, John) :-
	Class in 1..6,
	DiffClass #\= Class,
	element(Period, Suzy, Class),
	element(Period, Nathan, Class),
	element(Period, John, DiffClass).</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A very important use of element is in helping to constrain different facts.</p>
</div>
<div class="paragraph">
<p>For example, suppose we have a group of people, and we&#8217;ve numbered them by the alphabetic order of their names. Now we want to constrain a pair to be likely romantic partners. Being heterosexist and ageist, lets say we want to constrain them to be of opposite sexes and within 10 years difference in age.</p>
</div>
<div class="paragraph">
<p>This example also shows getting from index numbers to what we finally want - the names. It violates a rule of style for clp(fd) - set up your model in one predicate, label it in another - for pedagogic reasons.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Romantic Partners</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).

names([amy,bill,charley,deanna,eric,frieda,george,harley]).
% women are 1, men are 0
genders([1,0,0,1,0,1,0,0]).
ages([22,19,73,65,40,38,25,27]).

% maps compatible names
romance(A, B) :-
    names(Names),
    length(Names, NameLength),
    AIndex in 1..NameLength,
    BIndex in 1..NameLength,
    genders(G),
    element(AIndex, G, AG),
    element(BIndex, G, BG),
    AG #\= BG,
    ages(Ages),
    element(AIndex, Ages, AAge),
    element(BIndex, Ages, BAge),
    AAge #&lt; BAge #==&gt; AAge + 10 #&gt;= BAge,
    AAge #&gt;= BAge #==&gt; BAge + 10 #&gt;= AAge,
    AIndex #&lt; BIndex, % remove unwanted symmetry and reflexiveness
    label([AIndex, BIndex]),
    nth1(AIndex, Names, A),
    nth1(BIndex, Names, B).


7 ?- romance(A,B).
A = amy,
B = bill ;
A = amy,
B = george ;
A = amy,
B = harley ;
A = charley,
B = deanna ;
A = eric,
B = frieda ;
false.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_circuit_list">13.4. circuit(+List)</h3>
<div class="paragraph">
<p>The documentation for this is more confusing than enlightening.</p>
</div>
<div class="paragraph">
<p><code>circuit/1</code> takes a list of variables and constrains them to form a <em>circuit</em> - a sequence where each number after the first is Vn+1 = Vn mod L + 1 . Where Vn is an element, Vn+1 is the next element, and L is the length of the list.</p>
</div>
<div class="paragraph">
<p>So this is <em>clock arithmetic</em>.</p>
</div>
<div class="listingblock">
<div class="title">circuit example</div>
<div class="content">
<pre>?- length(Vs, _), circuit(Vs), label(Vs).
Vs = [] ;
Vs = [1] ;
Vs = [2, 1] ;
Vs = [2, 3, 1] ;
Vs = [3, 1, 2] ;
Vs = [2, 3, 4, 1] .</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automaton">13.5. automaton</h3>
<div class="paragraph">
<p>Automaton is the 900 lb gorilla of sequencing.</p>
</div>
<div class="paragraph">
<p>Automaton comes from <em>automata theory</em> , the study of abstract machines. <code>automaton/3</code> constrains it&#8217;s first argument to be an element of a language that can be recognized by a finite acceptor. <code>automaton/8</code> constrains it&#8217;s first argument to be an element of a language that can be recognized by a pushdown acceptor.</p>
</div>
<div class="paragraph">
<p>Do what? (Mathematicians avert your eyes, I&#8217;m going to explain finite automata while playing fast and loose).</p>
</div>
<div class="paragraph">
<p>A finite automaton is a bit like a hopscotch game. You have a (finite) set of <em>states</em> and directional arcs between them. Each arc is associated with an input. Here&#8217;s a typical automaton.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/automatona.png" alt="A Typical Automaton">
</div>
</div>
<div class="paragraph">
<p>Start on the green state. Read the first element in the sequence, and if there&#8217;s an arc labeled with it, go to that state. If not,  your sequence is not in the language. If there is, repeat in the new state - read the next element, and try to follow the arc. If you are in a blue state what you&#8217;ve read so far is part of the language.</p>
</div>
<div class="paragraph">
<p>Our language accepts one or more 0&#8217;s, followed by a 1, then a 2.</p>
</div>
<div class="paragraph">
<p>The green states are called source states, the blue ones sink states. A state could be both a sink and a source.</p>
</div>
<div class="paragraph">
<p>And here&#8217;s how to encode it in SWI-Prolog:</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. single source automaton</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>single_source_automaton(Vs) :-
	automaton(Vs, [source(a), sink(d)],
		  [arc(a,0,b),
		   arc(b,0,b),
		   arc(b,1,c),
		   arc(c,2,d)
		   ]).

demo_single_source(Vs) :-
	length(Vs, 4),
	single_source_automaton(Vs),
	label(Vs).</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s a variation on our first automaton that accpets the same as the first automaton, but allows you to add 10 to all the numbers, so it accepts sequences like 10,10,10,10,11,12.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/automaton.png" alt="Variation that also accepts sequences with each 10+ first">
</div>
</div>
<div class="exampleblock">
<div class="title">Example 9. multi source automaton</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>multi_source_automaton(Vs) :-
	automaton(Vs, [source(a),source(e), sink(d), sink(h)],
		  [arc(a,0,b),
		   arc(b,0,b),
		   arc(b,1,c),
		   arc(c,2,d),
		   arc(e,10,f),
		   arc(f,10,f),
		   arc(f,11,g),
		   arc(g,12,h)]).

demo_len(Vs) :-
	length(Vs, 4),
	multi_source_automaton(Vs),
	label(Vs).</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>automaton/3 example - certain employees can&#8217;t work at night, others on weekends, we encode this with an automaton that reads a list of who&#8217;se on shift.
Maybe enough with the employee examples - how about valid messages?</p>
</div>
<div class="paragraph">
<p>Automaton/8  - on hold til I understand it</p>
</div>
<div class="paragraph">
<p>example for counters - extend the employee example so employees get a max and min number of shifts</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scheduling">14. Scheduling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Scheduling is something we do every day. Bob can only meet from 2 to 3, you need a couple uninterrupted hours to think about the data base, mom&#8217;s coming by for lunch. It&#8217;s also a major economic constraint - the factory can make tractor parts from march to july but has to convert to making beanie babies for christmas.</p>
</div>
<div class="paragraph">
<p>serialized
<sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub></p>
</div>
<div class="paragraph">
<p>Serialized expresses the common constraint of not being in two places at once. It takes two lists of the same length, the first is start times and the second durations. It constrains them that intervals defined by the starts and durations don&#8217;t overlap. Notice that the starts don&#8217;t have to be in order - that is, serialized([4,0,2], [1,1,1]) succeeds.</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. dailyschedule</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(pairs)).

my_schedule_today(Starts, Durations) :-
  % unordered list of stuff to do today
  % in a real problem we'd probably use minutes, these are hours in 24 hour format
    Starts = [PrepForSmith, MeetWithSmith, _WriteDBInstaller, Lunch, _CallAlice, _ReadDocs],
  % and how long they'll take
    Durations = [2, 1, 2, 1, 1, 1],
  % make all of them start in 9am to 5pm
    Starts ins 9..17,
  % and make sure lunch happens at noon or 1pm
    Lunch in 12 \/ 13,
  % Meeting with Smith is planned for 1pm
    MeetWithSmith #= 13,
  % have to do the prep before the meeting
	PrepForSmith #&lt; MeetWithSmith,
  % enforce being serialized
    serialized(Starts, Durations).

demo_my_schedule(Starts, Durations) :-
	my_schedule_today(Starts, Durations),
	append(Starts, Durations, Vars),
	label(Vars),
	pairs_keys_values(NameDurs ,
       ['Prep for Smith', 'Meet With Smith', 'Write DB Installer', 'Lunch', 'Call Alice', 'Read Flubbercalc Docs'], Durations),
	pairs_keys_values(Pairs, Starts, NameDurs),
	keysort(Pairs, Sorted),
	pairs_keys_values(Sorted, SortStarts, SortNameDurs),
	print_sched(SortStarts, SortNameDurs).

print_sched([], _).
print_sched([Start | ST], [Name-Duration | T]) :-
	format('~w: ~w  (~w hr)~n', [Start, Name, Duration]),
	print_sched(ST, T).

8 ?- demo_my_schedule(Starts, Durations).
9: Prep for Smith  (2 hr)
11: Call Alice  (1 hr)
12: Lunch  (1 hr)
13: Meet With Smith  (1 hr)
14: Write DB Installer  (2 hr)
16: Read Flubbercalc Docs  (1 hr)
Starts = [9, 13, 14, 12, 11, 16],
Durations = [2, 1, 2, 1, 1, 1] ;
9: Prep for Smith  (2 hr)
11: Call Alice  (1 hr)
12: Lunch  (1 hr)
13: Meet With Smith  (1 hr)
14: Write DB Installer  (2 hr)
17: Read Flubbercalc Docs  (1 hr)
Starts = [9, 13, 14, 12, 11, 17],
Durations = [2, 1, 2, 1, 1, 1]</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_global_cardinality_3">14.1. global_cardinality/3</h3>
<div class="paragraph">
<p><code>global_cardinality/3</code> counts the number of occurances of each value in it&#8217;s first argument.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example. Suppose we have a list of employees for the shifts in a 24/7 convenience store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>shifts([1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,4,5,6,4,5,3]).</pre>
</div>
</div>
<div class="paragraph">
<p>we want to find out how many shifts each employee gets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>shifts([1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,4,5,6,4,5,3]).

count_shifts(Counts) :-
     shifts(Shifts),
     bagof(X, between(1,6,X), Keys),
     length(Values, 6),
     pairs_keys_values(Counts, Keys, Values),
     global_cardinality(Shifts, Counts, []).</pre>
</div>
</div>
<div class="paragraph">
<p>Remember, we&#8217;re in constraint land, so this works even if you don&#8217;t know
shifts <em>ahead of time</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>post_shifts(Counts) :-
     length(UnknownShifts, 21),
     bagof(X, between(1,6,X), Keys),
     length(Values, 6),
     pairs_keys_values(Counts, Keys, Values),
     global_cardinality(UnknownShifts, Counts, []),
     % at this point I have Counts and UnknownShifts constrained,
     % though I don't know UnknownShifts
     shifts(UnknownShifts). % now it's bound</pre>
</div>
</div>
<div class="paragraph">
<p><code>global_cardinality/3</code> has two options</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>consistency(value)</code>  -  presents a <em>weaker</em> consistency. I don&#8217;t know what this is, if you find out let me know</p>
</li>
<li>
<p><code>cost(Cost, Matrix)</code> - given a matrix of values for key i in position j, constrain the total cost to Cost</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">global_cardinality Exercise</div>
<div class="paragraph">
<p>Design an <strong>exercise</strong> that covers the <code>cost/2</code> option of global_cardinality. Include a solution.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__code_cumulative_2_code_and_code_cumulative_1_code">14.2. <code>cumulative/2</code> and <code>cumulative/1</code></h3>
<div class="paragraph">
<p><code>cumulative/2</code> takes a list of <em>tasks</em> and constrains them to not exceed a limit at any time during the tasks.</p>
</div>
<div class="paragraph">
<p>Tasks can be specified flexibly, by any combination of two of start, duration, and end. Each task also has an amount of resources it uses, and a task identifier.</p>
</div>
<div class="paragraph">
<p><code>cumulative/1</code> just defaults the limit to 1.</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. mechanics</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>%
%  We have 3 mechanics, and a number of repair jobs to do
%  Transmission jobs take two mechanics
%
%  Find a set of start times for the jobs during a 10 hour day
%
task_names([
    transmission, brake_job_1, brake_job_2, diagnosis_1,
    diagnosis_2, fuel_injection]).

tasks([
    task(S1,3,_,2,1),
    task(S2,1,_,1,2),
    task(S3,1,_,1,3),
    task(S4,3,_,1,4),
    task(S5,3,_,1,5),
    task(S6,2,_,1,6)], [S1, S2, S3, S4, S5, S6]).

find_task_starts(S) :-
	length(S, 6),
	S ins 0..9,
	tasks(Tasks, S),
	cumulative(Tasks, [limit(3)]),
	label(S).

2 ?- find_task_starts(S).
S = [0, 0, 1, 2, 3, 3] ;
S = [0, 0, 1, 2, 3, 4] ;
S = [0, 0, 1, 2, 3, 5] ;
S = [0, 0, 1, 2, 3, 6] ;
S = [0, 0, 1, 2, 3, 7] .</pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">cumulative Exercise</div>
<div class="paragraph">
<p>1) It looks like the mechanics aren&#8217;t very busy. Add a few more tasks.</p>
</div>
<div class="paragraph">
<p>2) Mechanic 3 only works the first 3 hours of the day. Modify the example to take this into account.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optimization">15. Optimization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We frequently need not only to satisfy a set of constraints, but to find the optimal solution. Problems like "Which of these products should this factory make to maximize profit?" and "Using 3 mechanics, how fast can we repair all these cars?" are optimization problems.</p>
</div>
<div class="paragraph">
<p><code>label/1</code> has an arity two version with a slightly different name, <code>labeling/2</code>.
The options are the first argument. The options are important for optimization problems, and for increasing the efficiency of the labeling process.</p>
</div>
<div class="paragraph">
<p>The two we&#8217;re concerned with right now are <code>max/1</code> and <code>min/1</code> . Adding one of them to the options causes the solutions to be presented in order, with the variable in the leftmost max or min sorted first, then proceeding down the list.
max terms sort decreasing order, min terms sort increasing order.</p>
</div>
<div class="listingblock">
<div class="title">inorder</div>
<div class="content">
<pre>7 ?- [X,Y] ins 1..3, labeling([max(X), min(Y)], [X,Y]).
X = 3,
Y = 1 ;
X = 3,
Y = 2 ;
X = Y, Y = 3 ;
X = 2,
Y = 1 ;
X = Y, Y = 2 ;
X = 2,
Y = 3 ;
X = Y, Y = 1 ;
X = 1,
Y = 2 ;
X = 1,
Y = 3 ;
false.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_making_labeling_fast">16. Making Labeling Fast</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Internally, <code>labeling/2</code> attempts to assign values to variables one at a time. Each time a value is chosen, a subtree of possibilities is removed. You want to make those subtrees as large as possible.</p>
</div>
<div class="sect2">
<h3 id="_how_to_label_efficiently">16.1. How To Label Efficiently</h3>
<div class="paragraph">
<p>Start by ordering your variables for labeling. Place the variables that will reduce the search tree by the largest value first. Knowing which these are depends on knowledge of the domain, but you can accumulate data in use if necessary.</p>
</div>
<div class="paragraph">
<p>Often, within a variable you have latitude how to assign labels. Suppose you&#8217;re working on a medical treatment recommending system. Here&#8217;s the items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>treat for radiation exposure</p>
</li>
<li>
<p>prescribe antibiotics</p>
</li>
<li>
<p>provide hyperbaric repressurization</p>
</li>
<li>
<p>intubate to provide airway</p>
</li>
<li>
<p>prescribe painkillers</p>
</li>
<li>
<p>prescribe anti-cobra venom</p>
</li>
<li>
<p>prescribe blood pressure regulators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Common sense is that, hopefully, radiation exposure will be less common than sniffles, so we&#8217;ll be matching <em>prescribe antibiotics</em> more often than <em>treat for radiation exposure</em>.  So examining items in this order is likely to be faster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prescribe painkillers</p>
</li>
<li>
<p>intubate to provide airway</p>
</li>
<li>
<p>prescribe blood pressure regulators</p>
</li>
<li>
<p>prescribe antibiotics</p>
</li>
<li>
<p>provide hyperbaric repressurization</p>
</li>
<li>
<p>prescribe anti-cobra venom</p>
</li>
<li>
<p>treat for radiation exposure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Prolog this will look something like</p>
</div>
<div class="listingblock">
<div class="title">Better Order</div>
<div class="content">
<pre>treatments([painkillers,
			intubate,
			bp_regulators,
			antibiotics,
			hyperbaric_chamber,
			anti_cobra_venom,
			radiation_exposure
			]).</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_settings">16.2. settings</h3>
<div class="paragraph">
<p>There are 3 settings in the first argument of <code>labeling/2</code> ; variable selection strategy, value order, and branching strategy. Choose one value for each setting (or use the defaults).</p>
</div>
<div class="paragraph">
<p>At most one option of each category can be specified, and an option must not occur repeatedly.</p>
</div>
<div class="paragraph">
<p>To some extent, picking the best settings is a matter of experiment. If you get desperate, there&#8217;s an undocumented <code>random_value(Seed)</code> (props to <a href="https://github.com/adbenitez">adbenitez</a> for pointing
this out) or <code>random_variable</code> .</p>
</div>
<div class="paragraph">
<p>Parts of this section are copied from the documentation.</p>
</div>
<div class="sect3">
<h4 id="_variable_selection_strategy">16.2.1. variable selection strategy</h4>
<div class="paragraph">
<p>The variable selection strategy lets you specify which variable of Vars is labeled next and is one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>leftmost</code> - Label the variables in the order they occur in Vars. This is the default.</p>
</li>
<li>
<p><code>ff</code>  First fail. Label the leftmost variable with smallest domain next, in order to detect infeasibility early. This is often a good strategy when there are small domains for the subsequent variables when a first variable is chosen.</p>
</li>
<li>
<p><code>ffc</code> Of the variables with smallest domains, the leftmost one participating in most constraints is labeled next. Applying a constraint has to remove a subtree, so this can be a good strategy.</p>
</li>
<li>
<p><code>min</code>  Label the leftmost variable whose lower bound is the lowest next. note that this is <code>min/0</code>, different than <code>min/1</code>, which determines solution order and is discussed in the previous section above. This is a good tactic if you&#8217;re trying to minimize some global value that is likely to be lower if various variables are (e.g. a minimum cost solution).</p>
</li>
<li>
<p><code>max</code>  Label the leftmost variable whose upper bound is the highest next. This too is different than <code>max/1</code>.  And the advice for <code>min</code> applies to <code>max</code> when trying to maximize a global value.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_value_order">16.2.2. value order</h4>
<div class="paragraph">
<p>The value order is one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>up</code> Try the elements of the chosen variable&#8217;s domain in ascending order. This is the default.</p>
</li>
<li>
<p><code>down</code> Try the domain elements in descending order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obviously, if you&#8217;ve got an assymmetric distribution, like we demonstraed in how to label efficiently above, try elements in most common first order.</p>
</div>
</div>
<div class="sect3">
<h4 id="_branching_strategy">16.2.3. branching strategy</h4>
<div class="paragraph">
<p>The branching strategy is one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>step</code> For each variable X, a choice is made between X = V and X #\= V, where V is determined by the value ordering options. This is the default.</p>
</li>
<li>
<p><code>enum</code>  For each variable X, a choice is made between X = V_1, X = V_2 etc., for all values V_i of the domain of X. The order is determined by the value ordering options.</p>
</li>
<li>
<p><code>bisect</code> For each variable X, a choice is made between X #=&lt; M and X #&gt; M, where M is the midpoint of the domain of X. Choose this option if many variables are selections among a range of integers, a <em>value</em>, rather than one among a set of enumerated values (e.g. percentages, vs a=0, b=1, c=2)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_and_testing">17. Debugging and Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Isolating the portion of the program that sets up the constraints allows you to
see the constrained domains in the top level.</p>
</div>
<div class="paragraph">
<p>Here are some predicates that are useful for debugging and for interfacing clp(fd) with the rest of the Prolog environment.</p>
</div>
<div class="paragraph">
<p><code>fd_var(+Var)</code> True iff Var is a CLP(FD) variable.</p>
</div>
<div class="paragraph">
<p><code>fd_inf(+Var, -Inf)</code>  Inf is the infimum of the current domain of Var.</p>
</div>
<div class="paragraph">
<p><code>fd_sup(+Var, -Sup)</code> Sup is the supremum of the current domain of Var.</p>
</div>
<div class="paragraph">
<p><code>fd_size(+Var, -Size)</code> Determine the size of a variable&#8217;s domain. Size is the number of elements of the current domain of Var, or the atom sup if the domain is unbounded.</p>
</div>
<div class="paragraph">
<p><code>fd_dom(+Var, -Dom)</code>  Dom is the current domain of Var. This predicate is useful if you want to reason about domains. If you just want to display domains for debugging, use the graphic debugger or toplevel.</p>
</div>
<div class="paragraph">
<p><code>indomain/1</code> binds it&#8217;s argument to members of it&#8217;s domain on backtracking.</p>
</div>
<div class="paragraph">
<p>For example, to implement a custom labeling strategy, you may need to inspect the current domain of a finite domain variable. With the following code, you can convert a finite domain to a list of integers:</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. domainAsIntegers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>dom_integers(D, Is) :- phrase(dom_integers_(D), Is).

dom_integers_(I)      --&gt; { integer(I) }, [I].
dom_integers_(L..U)   --&gt; { numlist(L, U, Is) }, Is.
dom_integers_(D1\/D2) --&gt; dom_integers_(D1), dom_integers_(D2).
Example:

?- X in 1..5, X #\= 4, fd_dom(X, D), dom_integers(D, Is).
D = 1..3\/5,
Is = [1,2,3,5],
X in 1..3\/5.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Consider clp(fd) for writing mocks.</p>
</div>
<div class="paragraph">
<p><code>call_residue_vars/2</code> calls a predicate, then reports all unresolved constraints or frozen variables. Since usually a proper program resolves all it&#8217;s variables, this is useful for finding things not resolved.</p>
</div>
<div class="paragraph">
<p>Beware that it may be buggy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_applying_constraints_in_stages">18. Applying Constraints in Stages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Being able to <em>hang on</em> to a system of of constrained variables, apply more, and then back up and remove the later constraints is useful.</p>
</div>
<div class="paragraph">
<p>For example, suppose you have a constraint based drawing program - the sort of program where you draw pieces, and if one is nearly aligned with the other, the program <em>'realizes</em>' you want them vertically or horizontally aligned. If you then drag one of the blocks, they all move to maintain the constraint.</p>
</div>
<div class="paragraph">
<p>To resolve the actual position of the blocks, you&#8217;re going to have to constrain one of them to the position it was dragged to, causing everything to constrain to single values. But now you&#8217;ve lost all your constraints!</p>
</div>
<div class="paragraph">
<p>There are two solutions to this. The first, backtracking, can work in many situations, but of course enforces a certain structure on the program. So this is more appropriate for situations like a mixed search-constraint strategy, where you set up some constraints, then search, adding different constraints, and backtracking if the problem becomes overconstrained.</p>
</div>
<div class="paragraph">
<p>The second solution is <code>copy_term/2</code> .</p>
</div>
<div class="paragraph">
<p><code>copy_term/2</code> copies a term (often a list of domain variables) and makes a new term with the same <em>shape</em> but with new variables. The copy includes the attributes (and hence the constraints).</p>
</div>
<div class="paragraph">
<p>By the same <em>shape</em>, we mean:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>atomic items match identical items</p>
</li>
<li>
<p>variables match variables</p>
</li>
<li>
<p>lists match lists of the same length whose items are the same shape.</p>
</li>
<li>
<p>compound terms match compound terms of the same functor and arity, whose arguments are the same shape.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 13. copyTerm</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>10 ?- copy_term(foo([bar, A, meep(B, [1,2])], 3), Copy).
Copy = foo([bar, _G2450, meep(_G2456, [1, 2])], 3).</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>So what happens with constraints?</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. copyTermAttributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>3 ?- X in 0..10, Y in 0..5, X #&lt; Y, copy_term(foo(X,Y), foo(XA, YA)), YA = 3.
YA = 3,
X in 0..4,
X#=&lt;Y+ -1,
Y in 1..5,
XA in 0..2.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Copying half of the constrained variables is generally not a great idea, you&#8217;ll end up with links outside your constraint system. Not strictly forbidden, but do it only deliberately, since usually you want the constraint system in a <em>stable</em> place you can come back to.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. copyTerm Half Attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>5 ?- X in 0..10, Y in 0..5, X #&lt; Y, copy_term([Y], [YA]), YA = 3.
YA = 3,
X in 0..4,
X#=&lt;Y+ -1,
Y in 1..5.

--------------</pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Constrained Graphics Exercise</div>
<div class="paragraph">
<p>Write a small graphics program, using whatever graphics environment you&#8217;re comfortable with, that draws a set of dots on the screen. If you move one of the dots to be aligned with another, vertically or horizontally, within a few pixels, then the two should be linked, and move together. Holding down shift always just moves one dot.</p>
</div>
<div class="paragraph">
<p>Extra Credit
Expand your program into a small diagram editor.</p>
</div>
<div class="paragraph">
<p>(Note, you&#8217;re near the end of the tutorial, you might want to read to the end at the same time you&#8217;re working this problem).</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Constraint Shell</div>
<div class="paragraph">
<p>Implement a constraint shell decision support system. This should allow the user
to define constraints one at a time using some simple command language (not programming)
and see the domains of variables. The user should be able to remove any of the constraints
they have entered.</p>
</div>
<div class="paragraph">
<p>Sample run</p>
</div>
<div class="listingblock">
<div class="content">
<pre>?-decision_support.
Decision Support (type h for help)
ds=h
l = list all variables and constraints
&lt;variable name&gt; in &lt;integer&gt; thru &lt;integer&gt; = define new variable
&lt;variable name&gt; &lt;operator&gt; &lt;integer or variable name&gt; = define new constraint
r &lt;number&gt;  = retract constraint &lt;number&gt;
q = quit

ds=a in 1 thru 10
a in 1..10
ds=b in 1 thru 10
b in 1..10
ds=a &lt; b
#1: a &lt; b
ds=b &lt; 5
#2: b &lt; 5
ds=l
variables
a in 1..3
b in 1..4
constraints
#1: a &lt; b
#2: b &lt; 5
ds=r 2
retracting #2: b &lt; 5
ds=b &lt; 8
#3: b &lt; 8
ds=l
variables
a in 1..6
b in 1..7
constraints
#1: a &lt; b
#3: b &lt; 8
ds=q
?-</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_making_your_own_constraints">19. Making Your Own Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, you often don&#8217;t need to make a custom constraint, you need a custom convenience predicate. If you need <em>sort of near to</em>, which constrains X and Y to be N to M spaces from each other, then you can write a normal predicate that applies all the constraints. This is  what you&#8217;ve been doing all along in this tutorial.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Sort Of Near To</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>sort_of_near_to(X, Y, N, M) :-
	X #&gt; Y #==&gt; X - N #&gt;= Y  #/\  X - M - 1 #&lt; Y,
	X #=&lt; Y #==&gt; Y - N #&gt;= X #/\ Y - M - 1 #&lt; X.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you do actually need to write a constraint, here&#8217;s how.</p>
</div>
<div class="paragraph">
<p>First, you&#8217;ll need some setup</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Own Constraint Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>:- use_module(library(clpfd)).

:- multifile clpfd:run_propagator/2.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>then you need to define the predicate the user uses to apply your constraint.</p>
</div>
<div class="paragraph">
<p>There are three steps to complete in this predicate.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Convert the constraint to an internal form, the <em>propagator</em>, by calling <code>clpfd:make_propagator/2</code>.</p>
</li>
<li>
<p>Attach each variable to the propagator by calling <code>clpfd:init_propagator/2</code></p>
</li>
<li>
<p>Trigger the propagator so the initial state is set, we fail if we&#8217;re overconstrained, and the initial domain is set, using <code>clpfd:trigger_once/1</code> .</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Example 18. Even Predicate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>% constrain X to be even
even(X) :-
        clpfd:make_propagator(even(X), Prop),  <img src="./images/icons/callouts/1.png" alt="1">
        clpfd:init_propagator(X, Prop),  <img src="./images/icons/callouts/2.png" alt="2">
        clpfd:trigger_once(Prop). <img src="./images/icons/callouts/3.png" alt="3"></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Convert the constraint into an internal form <code>Prop</code> , the <em>propagator</em> .</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Attach each variable (only X here) to the internal propagator.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Trigger the Propagator once to add the initial state to the system.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Finally, you need to define the conditional check that&#8217;s called when the constraint is evaluated. This requires adding a clause to <code>clpfd:run_propagator/2</code> .</p>
</div>
<div class="paragraph">
<p>The first argument of <code>clpfd:run_propagator/2</code> must match the declaration in <code>make_propagator/2</code>.</p>
</div>
<div class="paragraph">
<p>The second argument is a mutable state maintained by clp(fd). It can be used to <em>kill</em> a constraint if it need no longer be triggered, if the constraint has failed or the variable is bound to a valid value, or if it&#8217;s domain is now reduced to only values that meet the constraint.</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Even Callback</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>% constrain X to be even
clpfd:run_propagator(even(X), MState) :-
        (   integer(X) -&gt; clpfd:kill(MState), 0 is X mod 2
        ;   true
        ).</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And now we can use our new constraint.</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. New Constraint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>[debug] 26 ?- even(1).
false.

[debug] 27 ?- even(2).
true.

[debug] 28 ?- even(X),X = 2.
X = 2.

[debug] 29 ?- even(X),X = 3.
false.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice that run_propagator is nondeterministic. It can fail (signaling that there is no solution for X). For example, even(X),X = 3.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">exercise Try even</div>
<div class="paragraph">
<p>Put a spy point on <code>clpfd:run_propagator/2</code> and query even(X), X = 3.</p>
</div>
<div class="paragraph">
<p>How many times is run_propagator called?</p>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
Fun fact - the Julian library uses clp(fd) extensively.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">20. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Remember, constraint programming is something you should consider any time you have several variables and need to solve for a compatible solution among all of them.</p>
</div>
<div class="paragraph">
<p>SWI-Prolog ships with a number of constraint libraries. If you&#8217;re truly inspired, make a tutorial similar to this one for clp(b) or clp(qr) or CHR. If you&#8217;re inspired to do this, drop me a line, as we&#8217;re trying to get a nice library of these tutorials together, with a common format so we can automate parts of the process downstream.</p>
</div>
<div class="paragraph">
<p>I hope you&#8217;ve enjoyed this tutorial. If you notice any mistakes, or want to suggest improvements, or just are totally stumped, email annie66us (at) yahoo_(dotcom) and let me know.</p>
</div>
<div class="paragraph">
<p>You can often find me as Anniepoo on ##prolog channel on freenode.net IRC.</p>
</div>
<div class="paragraph">
<p>Thanks to Markus Triska for the clp(fd) library. Hoot Markus!  Thanks to Alan Baljeu for helping with some confusing points. Thanks to Michael Richter for some of the software pipeline setup that produces these tutorials.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-01-20 13:27:18 CET
</div>
</div>
</body>
</html>